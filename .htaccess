RewriteEngine On

# Prevent infinite loops
RewriteCond %{ENV:REDIRECT_STATUS} ^$

# Handle drupal requests - check if file/directory exists in drupal folder
RewriteCond %{REQUEST_URI} ^/drupal/(.*)
RewriteCond %{DOCUMENT_ROOT}/drupal/%1 -f [OR]
RewriteCond %{DOCUMENT_ROOT}/drupal/%1 -d
RewriteRule ^drupal/(.*)$ drupal/$1 [L]

# Handle drupal root request
RewriteRule ^drupal/?$ drupal/ [L]

# Handle all other requests - serve from react folder if file exists
RewriteCond %{REQUEST_URI} !^/drupal/
RewriteCond %{DOCUMENT_ROOT}/react/dist/$1 -f [OR]
RewriteCond %{DOCUMENT_ROOT}/react/dist/$1 -d
RewriteRule ^(.*)$ react/$1 [L]

# Fallback for React SPA routing (when file doesn't exist)
RewriteCond %{REQUEST_URI} !^/drupal/
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ react/index.html [L]